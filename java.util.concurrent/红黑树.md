# 什么是红黑树

> 红黑树（Red Black Tree） 是一种自平衡二叉查找树，是在计算机科学中用到的一种数据结构。红黑树和AVL树类似，都是在进行插入和删除操作时通过特定操作保持二叉查找树的平衡，从而获得较高的查找性能。它虽然是复杂的，但它的最坏情况运行时间也是非常良好的，并且在实践中是高效的： 它可以在O(log n)时间内做查找，插入和删除，这里的n 是树中元素的数目。



# 红黑树的性质

- 性质1：每个节点要么是黑色，要么是红色。
- 性质2：根节点是黑色。
- 性质3：每个叶子节点（NIL）是黑色。
- 性质4：每个红色结点的两个子结点一定都是黑色。
- **性质5：任意一结点到每个叶子结点的路径都包含数量相同的黑结点。**



由性质4可以得出------在红黑树中不存在两个连续的红色节点

举例，下图为数字0-10所组成的一个红黑树，该红黑树满足上面五个性质要求

![image-20190831220538485](/Users/lijiaxing/Library/Application Support/typora-user-images/image-20190831220538485.png)

# 树的左旋与右旋



## 左旋

左旋：以某个结点作为支点(旋转结点)，其右子结点变为旋转结点的父结点，右子结点的左子结点变为旋转结点的右子结点，左子结点保持不变。示意图如下：



![image-20190831223358141](/Users/lijiaxing/Library/Application Support/typora-user-images/image-20190831223358141.png)



## 右旋

**右旋**：以某个结点作为支点(旋转结点)，其左子结点变为旋转结点的父结点，左子结点的右子结点变为旋转结点的左子结点，右子结点保持不变。示意图如下

![image-20190831223445283](/Users/lijiaxing/Library/Application Support/typora-user-images/image-20190831223445283.png)

# 树的查找

树的查找流程如下图所示：

![image-20190831225831756](/Users/lijiaxing/Library/Application Support/typora-user-images/image-20190831225831756.png)

# 红黑树的插入

## 红黑树的插入步骤

红黑树的插入操作分为两个步骤：

> 1. 先将要插入的节点放到红黑树的正确位置上
> 2. 通过自平衡操作修复红黑树，使其满足上述的5条性质

因为在插入元素之前这个树是满足红黑树性质要求的，所以插入之后生成的树也要满足红黑树的性质。



> 插入的新节点默认都是红色的

如果插入的新节点的颜色默认是黑色的话，则无论在什么位置插入都会破坏红黑树的性质。但如果默认是红色的话，至少在父节点是黑色节点的情况下，红色节点可以直接插入，无需进行自平衡操作。



### 红黑树的插入分为以下几种情况：

#### 情况1、当前树是空树，这时直接将当前节点插入到树的根节点处，并将当前节点的颜色改为黑色即可

#### 情况2、如果当前节点的父节点是黑色节点，则直接将当前节点插入到正确的位置即可，因为本次插入没有破坏红黑树的平衡，故无需做自平衡操作。

#### 情况3、如果当前节点的父节点是红色，这时将当前节点插入后将会破坏红黑树的性质4，即出现了两个连续的红色节点。这时就需要对红黑树进行自平衡操作。而此时又分为以下几种情况：

##### 	情况3.1、当前节点为红色，当前节点的父节点为红色，当前节点的叔叔节点也是红色，且当前节点是父节点的左子节点

​	**针对这种情况的自平衡操作是，将当前节点的父节点和叔叔节点染成黑色，并将当前节点的爷爷节点染		    			成红色即可。**

情况3.1的自平衡操作示意图如下：

假设当前要将节点9插入到最左侧的红黑树中，插入后破坏了红黑树的性质4，符合情况3.1，通过自平衡将其修正为一棵红黑树。修正后发现节点15和节点19又不符合红黑树的性质，则以节点15为基础递归向上进行自平衡操作，直到将整棵树修正为一棵红黑树为止。

![image-20190831234229235](/Users/lijiaxing/Library/Application Support/typora-user-images/image-20190831234229235.png)



##### 	情况3.2、当前节点为红色，当前节点的父节点为红色，当前节点的叔叔节点是黑色，且当前节点是父节点的左子节点

​	**针对这种情况自平衡的操作是，先以当前节点的父节点为指点进行右旋，右旋之后再将当前节点的父节点染成黑色，当前节点的兄弟节点染成红色**

情况3.2的自平衡操作示意图如下：

![image-20190901193648407](/Users/lijiaxing/Library/Application Support/typora-user-images/image-20190901193648407.png)

##### 情况3.3、当前节点为红色，当前节点的父节点为红色，当前节点的叔叔节点是黑色，且当前节点是父节点的右子节点

​	**针对这种情况自平衡的操作是，先对当前节点进行左旋操作，转换成情况3.2，接着按照情况3.2的方案做自平衡。**

情况3.3的自平衡操作示意图如下：

![image-20190901195424392](/Users/lijiaxing/Library/Application Support/typora-user-images/image-20190901195424392.png)

**到目前为止，讨论的所有插入情况都是假设当前节点的父节点是当前节点爷爷节点的左子节点的情况，对应的还有父节点是爷爷节点的右子节点的情况，其自平衡操作流程是上面三种情况的镜像。**



